name: CI

on: [push, pull_request]

jobs:

    build:

        runs-on: ubuntu-latest

        steps:
            - uses: actions/checkout@v2

            - name: build docker-compose
              run: docker-compose up -d

            - name: check running containers
              run: docker ps

            - name: wait the datastore with sportsdb is up and ready to be used
              run: docker-compose run ci_tests pipenv run wait_datastore

            - name: show docker-compose logs
              run: docker-compose logs --tail 100

            - name: curl sportsd_backend_python
              run: "curl http://localhost:4000 -H 'content-type: application/json' --data-binary '{\"query\":\"{players {id, full_name}}\"}'"
